# 数据库迁移指南

## 概述

本指南说明如何在打包好的程序中使用原项目的数据库数据。

## 方法一：使用迁移工具（推荐）

### 步骤 1：备份开发环境数据库

1. 在开发环境中运行迁移工具：
   ```bash
   python database_migration.py
   ```

2. 工具会自动：
   - 备份当前数据库到 `class_points_backup.db`
   - 提供自动恢复选项

### 步骤 2：迁移到打包程序

#### 自动迁移（推荐）
在迁移工具中选择 "y"，工具会自动：
- 在打包程序目录创建 `instance` 文件夹
- 复制数据库文件到正确位置

#### 手动迁移
如果选择手动迁移：
1. 将 `class_points_backup.db` 文件复制到打包程序的目录
2. 在打包程序目录创建 `instance` 文件夹
3. 将备份文件重命名为 `class_points.db` 并放入 `instance` 文件夹

### 打包程序目录结构
```
打包程序目录/
├── class_points_system.exe
└── instance/
    └── class_points.db    ← 数据库文件放在这里
```

## 方法二：手动迁移

### 步骤 1：找到开发环境数据库

开发环境的数据库位置：
```
项目根目录/
└── instance/
    └── class_points.db
```

### 步骤 2：复制到打包程序

1. 找到开发环境的 `instance/class_points.db` 文件
2. 复制该文件
3. 在打包程序目录创建 `instance` 文件夹
4. 粘贴数据库文件到 `instance` 文件夹中

## 方法三：数据库路径配置

### 开发环境 vs 打包环境

- **开发环境**：数据库在项目根目录的 `instance` 文件夹
- **打包环境**：数据库在可执行文件同目录的 `instance` 文件夹

### 路径检测逻辑

应用程序会自动检测运行环境：
- 如果是打包环境：数据库路径为 `可执行文件目录/instance/class_points.db`
- 如果是开发环境：数据库路径为 `项目根目录/instance/class_points.db`

## 验证迁移成功

1. 启动打包程序
2. 查看控制台输出的数据库文件位置
3. 确认显示的是打包程序目录下的路径
4. 在网页界面检查数据是否完整

## 常见问题

### Q: 打包程序启动后数据为空？
A: 检查数据库文件是否正确放置在 `instance` 文件夹中

### Q: 数据库文件找不到？
A: 确保 `instance` 文件夹与可执行文件在同一目录

### Q: 如何更新打包程序的数据库？
A: 重复迁移步骤，用新的数据库文件替换旧的

### Q: 可以同时使用开发环境和打包环境吗？
A: 可以，但建议使用不同的数据库文件，避免数据冲突

## 数据备份建议

1. **定期备份**：在重要操作前备份数据库
2. **版本控制**：为重要的数据库状态创建备份文件
3. **迁移测试**：在正式使用前测试数据迁移

## 注意事项

- 数据库文件包含所有学生、积分记录等重要数据
- 迁移前建议停止所有正在运行的应用程序
- 确保有足够的磁盘空间
- 建议在迁移前创建数据备份

## 故障排除

### 数据库文件损坏
如果数据库文件损坏：
1. 使用备份文件恢复
2. 如果没有备份，重新初始化数据库

### 权限问题
确保应用程序有读写 `instance` 文件夹的权限

### 路径问题
检查数据库文件路径是否正确，路径中不应包含中文或特殊字符